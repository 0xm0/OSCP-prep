 XML Injection
==============================================================================
XML is used extensively in web applications

    In Request & Responses to submit data & receive data from server.
    In Messages between back-end components
    AJAX mostly uses XML for communication with server.
    Browser extension components also use XML to communicate with server.
    Content type: text/xml

XML EXTERNAL ENTITY ATTACK ( XXE Injection )
Entity Reference:  

    Characters with special meaning in XML like "<" will generate an error as it is interpreted as the start of a new element. 
    To avoid errors, replace the "<" character with an entity reference (&lt;)
    Entity references always begin with an ampersand (&) and end with a semicolon (;)
    For < , >  the corresponding entities are     &lt;    &gt;
    XML allows CUSTOM ENTITIES to be defined at the start of XML document itself using DOCTYPE element.
    <!DOCTYPE note [ <!ENTITY testreference "referencevalue"> ]>
    &testreference; will be replaced by referencevalue

Vulnerability exists because 

    XML parsing libraries support the use of ENTITY REFERENCES.
    XML allows the use of EXTERNAL REFERENCES, whose values are fetched dynamically
    EXTERNAL ENTITY definitions use the URL Format & can refer to web URLs or local file.
    If the XML response contains an "External defined ENTITY", THEN the contents of specified URL or FILE are RETRIEVED & INCLUDED in the response.

ATTACKER simply specifies an external entity in his XML Request by adding or modifying DOCTYPE element.

     SYSTEM keyword is used to specify an EXTERNAL ENTITY
     URL may use also the    file:     protocol
    <!DOCTYPE note [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
    <!DOCTYPE note [ <!ENTITY xxe SYSTEM "http://www.foo.com/hack.txt"> ]>
    <foo>  &xxe;  </foo> 
    The contents of the file will replace      &xxe;

Consequences of XXE

    Attacker can use application as proxy to access external server as well as Internal resources and services
    Attacker can test for open ports on backend systems.
    Attacker can cause a DoS attack, by reading a file stream indefinitely.
    
    
How to Mitigate XXE Exploitation

Disable XML external entity and DTD processing in XML parser(s).

Use another data format such as JSON instead of XML.

Avoid serialisation of sensitive data.

Don’t run old XML processors or libraries — and the same applies for SOAP. Ensure all versions are upgraded to the latest stable release.

Impose appropriate server-side filtering on XML documents to remove the presence of malicious code (using methods described in the ‘Injection’ section of this article).

Run Static Application Security Testing programs over relevant code to identify potential vulnerabilities.
